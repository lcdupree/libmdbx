<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>libmdbx: Usage</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">libmdbx
   &#160;<span id="projectnumber">Please fetch tags and/or use non-obsolete git version.Please fetch tags and/or use non-obsolete git version.Please fetch tags and/or use non-obsolete git version.0 (2022-04-13T11:05:50+03:00)</span>
   </div>
   <div id="projectbrief">One of the fastest compact embeddable key-value ACID database without WAL.</div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('usage.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Usage </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="getting"></a>
Building &amp; Embedding</h1>
<p>Currently, libmdbx is only available in a <a href="https://en.wikipedia.org/wiki/Source_code">source code</a> form. Packages support for common Linux distributions is planned in the future, since release the version 1.0.</p>
<h2><a class="anchor" id="autotoc_md31"></a>
Never use tarballs nor zips automatically provided by Github !</h2>
<p>Please don't use tarballs nor zips which are automatically provided by Github. These archives do not contain version information and thus are unfit to build <em>libmdbx</em>. Instead of ones just clone the git repository, either download a tarball or zip with the properly amalgamated source core. Moreover, please vote for <a href="https://github.community/t/disable-tarball">ability of disabling auto-creation such unsuitable archives</a>.</p>
<h2><a class="anchor" id="autotoc_md32"></a>
Source code embedding</h2>
<p><em>libmdbx</em> provides two official ways for integration in source code form:</p>
<ol type="1">
<li>Using the amalgamated source code. <blockquote class="doxtable">
<p>The amalgamated source code includes all files required to build and use <em>libmdbx</em>, but not for testing <em>libmdbx</em> itself. </p>
</blockquote>
</li>
<li>Adding the complete original source code as a <code>git submodule</code>. <blockquote class="doxtable">
<p>This allows you to build as <em>libmdbx</em> and testing tool. On the other hand, this way requires you to pull git tags, and use C++11 compiler for test tool. </p>
</blockquote>
</li>
</ol>
<p><em><b>Please, avoid using any other techniques.</b></em> Otherwise, at least don't ask for support and don't name such chimeras <code>libmdbx</code>.</p>
<p>The amalgamated source code could be created from the original clone of git repository on Linux by executing <code>make dist</code>. As a result, the desired set of files will be formed in the <code>dist</code> subdirectory.</p>
<h2><a class="anchor" id="autotoc_md33"></a>
Building and Testing</h2>
<p>Both amalgamated and original source code provides build through the use <a href="https://cmake.org/">CMake</a> or <a href="https://www.gnu.org/software/make/">GNU Make</a> with <a href="https://en.wikipedia.org/wiki/Bash_(Unix_shell)">bash</a>. All build ways are completely traditional and have minimal prerequirements like <code>build-essential</code>, i.e. the non-obsolete C/C++ compiler and a <a href="https://en.wikipedia.org/wiki/Software_development_kit">SDK</a> for the target platform. Obviously you need building tools itself, i.e. <code>git</code>, <code>cmake</code> or GNU <code>make</code> with <code>bash</code>. For your convenience, <code>make help</code> and <code>make options</code> are also available for listing existing targets and build options respectively.</p>
<p>The only significant specificity is that git' tags are required to build from complete (not amalgamated) source codes. Executing **<code>git fetch --tags --force --prune</code>** is enough to get ones, or <code>git fetch --unshallow --tags --prune --force</code> after the Github's <a href="https://github.com/actions/checkout"><code>actions/checkout@v2</code></a> either set **<code>fetch-depth: 0</code>** for it.</p>
<p>So just using CMake or GNU Make in your habitual manner and feel free to fill an issue or make pull request in the case something will be unexpected or broken down.</p>
<h3><a class="anchor" id="autotoc_md34"></a>
Testing</h3>
<p>The amalgamated source code does not contain any tests for or several reasons. Please read <a href="https://github.com/erthink/libmdbx/issues/214#issuecomment-870717981">the explanation</a> and don't ask to alter this. So for testing <em>libmdbx</em> itself you need a full source code, i.e. the clone of a git repository, there is no option.</p>
<p>The full source code of <em>libmdbx</em> has a <a href="https://github.com/erthink/libmdbx/tree/master/test"><code>test</code> subdirectory</a> with minimalistic test "framework". Actually yonder is a source code of the <code>mdbx_test</code> â€“ console utility which has a set of command-line options that allow construct and run a reasonable enough test scenarios. This test utility is intended for <em>libmdbx</em>'s developers for testing library itself, but not for use by users. Therefore, only basic information is provided:</p>
<ul>
<li>There are few CRUD-based test cases (hill, TTL, nested, append, jitter, etc), which can be combined to test the concurrent operations within shared database in a multi-processes environment. This is the <code>basic</code> test scenario.</li>
<li>The <code>Makefile</code> provide several self-described targets for testing: <code>smoke</code>, <code>test</code>, <code>check</code>, <code>memcheck</code>, <code>test-valgrind</code>, <code>test-asan</code>, <code>test-leak</code>, <code>test-ubsan</code>, <code>cross-gcc</code>, <code>cross-qemu</code>, <code>gcc-analyzer</code>, <code>smoke-fault</code>, <code>smoke-singleprocess</code>, <code>test-singleprocess</code>, 'long-test'. Please run <code>make --help</code> if doubt.</li>
<li>In addition to the <code>mdbx_test</code> utility, there is the script <a href="https://github.com/erthink/libmdbx/blob/master/test/long_stochastic.sh"><code>long_stochastic.sh</code></a>, which calls <code>mdbx_test</code> by going through set of modes and options, with gradually increasing the number of operations and the size of transactions. This script is used for mostly of all automatic testing, including <code>Makefile</code> targets and Continuous Integration.</li>
<li>Brief information of available command-line options is available by <code>--help</code>. However, you should dive into source code to get all, there is no option.</li>
</ul>
<p>Anyway, no matter how thoroughly the <em>libmdbx</em> is tested, you should rely only on your own tests for a few reasons:</p>
<ol type="1">
<li>Mostly of all use cases are unique. So it is no warranty that your use case was properly tested, even the <em>libmdbx</em>'s tests engages stochastic approach.</li>
<li>If there are problems, then your test on the one hand will help to verify whether you are using <em>libmdbx</em> correctly, on the other hand it will allow to reproduce the problem and insure against regression in a future.</li>
<li>Actually you should rely on than you checked by yourself or take a risk.</li>
</ol>
<h3><a class="anchor" id="autotoc_md35"></a>
Common important details</h3>
<h4><a class="anchor" id="autotoc_md36"></a>
Build reproducibility</h4>
<p>By default <em>libmdbx</em> track build time via <code>MDBX_BUILD_TIMESTAMP</code> build option and macro. So for a <a href="https://en.wikipedia.org/wiki/Reproducible_builds">reproducible builds</a> you should predefine/override it to known fixed string value. For instance:</p>
<ul>
<li>for reproducible build with make: <code>make MDBX_BUILD_TIMESTAMP=unknown</code> ...</li>
<li>or during configure by CMake: <code>cmake -DMDBX_BUILD_TIMESTAMP:STRING=unknown</code> ...</li>
</ul>
<p>Of course, in addition to this, your toolchain must ensure the reproducibility of builds. For more information please refer to <a href="https://reproducible-builds.org/">reproducible-builds.org</a>.</p>
<h4><a class="anchor" id="autotoc_md37"></a>
Containers</h4>
<p>There are no special traits nor quirks if you use libmdbx ONLY inside the single container. But in a cross-container cases or with a host-container(s) mix the two major things MUST be guaranteed:</p>
<ol type="1">
<li>Coherence of memory mapping content and unified page cache inside OS kernel for host and all container(s) operated with a DB. Basically this means must be only a single physical copy of each memory mapped DB' page in the system memory.</li>
<li>Uniqueness of <a href="https://en.wikipedia.org/wiki/Process_identifier">PID</a> values and/or a common space for ones:<ul>
<li>for POSIX systems: PID uniqueness for all processes operated with a DB. I.e. the <code>--pid=host</code> is required for run DB-aware processes inside Docker, either without host interaction a <code>--pid=container:&lt;name|id&gt;</code> with the same name/id.</li>
<li>for non-POSIX (i.e. Windows) systems: inter-visibility of processes handles. I.e. the <code>OpenProcess(SYNCHRONIZE, ..., PID)</code> must return reasonable error, including <code>ERROR_ACCESS_DENIED</code>, but not the <code>ERROR_INVALID_PARAMETER</code> as for an invalid/non-existent PID.</li>
</ul>
</li>
</ol>
<h4><a class="anchor" id="autotoc_md38"></a>
DSO/DLL unloading and destructors of Thread-Local-Storage objects</h4>
<p>When building <em>libmdbx</em> as a shared library or use static <em>libmdbx</em> as a part of another dynamic library, it is advisable to make sure that your system ensures the correctness of the call destructors of Thread-Local-Storage objects when unloading dynamic libraries.</p>
<p>If this is not the case, then unloading a dynamic-link library with <em>libmdbx</em> code inside, can result in either a resource leak or a crash due to calling destructors from an already unloaded DSO/DLL object. The problem can only manifest in a multithreaded application, which makes the unloading of shared dynamic libraries with <em>libmdbx</em> code inside, after using <em>libmdbx</em>. It is known that TLS-destructors are properly maintained in the following cases:</p>
<ul>
<li>On all modern versions of Windows (Windows 7 and later).</li>
<li>On systems with the <a href="https://sourceware.org/glibc/wiki/Destructor%20support%20for%20thread_local%20variables"><code>__cxa_thread_atexit_impl()</code></a> function in the standard C library, including systems with GNU libc version 2.18 and later.</li>
<li>On systems with libpthread/ntpl from GNU libc with bug fixes <a href="https://sourceware.org/bugzilla/show_bug.cgi?id=21031">#21031</a> and <a href="https://sourceware.org/bugzilla/show_bug.cgi?id=21032">#21032</a>, or where there are no similar bugs in the pthreads implementation.</li>
</ul>
<h3><a class="anchor" id="autotoc_md39"></a>
Linux and other platforms with GNU Make</h3>
<p>To build the library it is enough to execute <code>make all</code> in the directory of source code, and <code>make check</code> to execute the basic tests.</p>
<p>If the <code>make</code> installed on the system is not GNU Make, there will be a lot of errors from make when trying to build. In this case, perhaps you should use <code>gmake</code> instead of <code>make</code>, or even <code>gnu-make</code>, etc.</p>
<h3><a class="anchor" id="autotoc_md40"></a>
FreeBSD and related platforms</h3>
<p>As a rule on BSD and it derivatives the default is to use Berkeley Make and <a href="https://en.wikipedia.org/wiki/Bash_(Unix_shell)">Bash</a> is not installed.</p>
<p>So you need to install the required components: GNU Make, Bash, C and C++ compilers compatible with GCC or CLANG. After that, to build the library, it is enough to execute <code>gmake all</code> (or <code>make all</code>) in the directory with source code, and <code>gmake check</code> (or <code>make check</code>) to run the basic tests.</p>
<h3><a class="anchor" id="autotoc_md41"></a>
Windows</h3>
<p>For build <em>libmdbx</em> on Windows the <em>original</em> CMake and <a href="https://en.wikipedia.org/wiki/Microsoft_Visual_Studio">Microsoft Visual Studio 2019</a> are recommended. Please use the recent versions of CMake, Visual Studio and Windows SDK to avoid troubles with C11 support and <code>alignas()</code> feature.</p>
<p>For build by MinGW the 10.2 or recent version coupled with a modern CMake are required. So it is recommended to use <a href="https://chocolatey.org/">chocolatey</a> to install and/or update the ones.</p>
<p>Another ways to build is potentially possible but not supported and will not. The <code>CMakeLists.txt</code> or <code>GNUMakefile</code> scripts will probably need to be modified accordingly. Using other methods do not forget to add the <code>ntdll.lib</code> to linking.</p>
<p>It should be noted that in <em>libmdbx</em> was efforts to avoid runtime dependencies from CRT and other MSVC libraries. For this is enough to pass the <code>-DMDBX_WITHOUT_MSVC_CRT:BOOL=ON</code> option during configure by CMake.</p>
<p>An example of running a basic test script can be found in the <a href="appveyor.yml">CI-script</a> for <a href="https://www.appveyor.com/">AppVeyor</a>. To run the <a href="test/long_stochastic.sh">long stochastic test scenario</a>, <a href="https://en.wikipedia.org/wiki/Bash_(Unix_shell)">bash</a> is required, and such testing is recommended with placing the test data on the <a href="https://en.wikipedia.org/wiki/RAM_drive">RAM-disk</a>.</p>
<h3><a class="anchor" id="autotoc_md42"></a>
Windows Subsystem for Linux</h3>
<p><em>libmdbx</em> could be used in <a href="https://en.wikipedia.org/wiki/Windows_Subsystem_for_Linux#WSL_2">WSL2</a> but NOT in <a href="https://en.wikipedia.org/wiki/Windows_Subsystem_for_Linux#WSL_1">WSL1</a> environment. This is a consequence of the fundamental shortcomings of <em>WSL1</em> and cannot be fixed. To avoid data loss, <em>libmdbx</em> returns the <code>ENOLCK</code> (37, "No record locks available") error when opening the database in a <em>WSL1</em> environment.</p>
<h3><a class="anchor" id="autotoc_md43"></a>
MacOS</h3>
<p>Current <a href="https://en.wikipedia.org/wiki/Xcode">native build tools</a> for MacOS include GNU Make, CLANG and an outdated version of Bash. Therefore, to build the library, it is enough to run <code>make all</code> in the directory with source code, and run <code>make check</code> to execute the base tests. If something goes wrong, it is recommended to install <a href="https://brew.sh/">Homebrew</a> and try again.</p>
<p>To run the <a href="test/long_stochastic.sh">long stochastic test scenario</a>, you will need to install the current (not outdated) version of <a href="https://en.wikipedia.org/wiki/Bash_(Unix_shell)">Bash</a>. To do this, we recommend that you install <a href="https://brew.sh/">Homebrew</a> and then execute <code>brew install bash</code>.</p>
<h3><a class="anchor" id="autotoc_md44"></a>
Android</h3>
<p>We recommend using CMake to build <em>libmdbx</em> for Android. Please refer to the <a href="https://developer.android.com/studio/projects/add-native-code">official guide</a>.</p>
<h3><a class="anchor" id="autotoc_md45"></a>
iOS</h3>
<p>To build <em>libmdbx</em> for iOS, we recommend using CMake with the <a href="https://cmake.org/cmake/help/latest/variable/CMAKE_TOOLCHAIN_FILE.html">"toolchain file"</a> from the <a href="https://github.com/leetal/ios-cmake">ios-cmake</a> project.</p>
<h1><a class="anchor" id="starting"></a>
Getting started</h1>
<blockquote class="doxtable">
<p>This section is based on Bert Hubert's intro "LMDB Semantics", with edits reflecting the improvements and enhancements were made in MDBX. See Bert Hubert's <a href="https://github.com/ahupowerdns/ahutils/blob/master/lmdb-semantics.md">original</a>. </p>
</blockquote>
<p>Everything starts with an environment, created by <a class="el" href="group__c__opening.html#ga109eb833997698fbb77912716596fe8e">mdbx_env_create()</a>. Once created, this environment must also be opened with <a class="el" href="group__c__opening.html#gabb7dd3b10dd31639ba252df545e11768">mdbx_env_open()</a>, and after use be closed by <a class="el" href="group__c__opening.html#ga3945614a024b9f9eb48e4ffa205b68be">mdbx_env_close()</a>. At that a non-zero value of the last argument "mode" supposes MDBX will create database and directory if ones does not exist. In this case the non-zero "mode" argument specifies the file mode bits be applied when a new files are created by <code>open()</code> function.</p>
<p>Within that directory, a lock file (aka LCK-file) and a storage file (aka DXB-file) will be generated. If you don't want to use a directory, you can pass the <a class="el" href="group__c__opening.html#gga9138119a904355d245777c4119534061ad5c4ae6a8fefe9b05ce17ec3e3bbda4f">MDBX_NOSUBDIR</a> option, in which case the path you provided is used directly as the DXB-file, and another file with a "-lck" suffix added will be used for the LCK-file.</p>
<p>Once the environment is open, a transaction can be created within it using <a class="el" href="group__c__transactions.html#ga9621bd463ec9efb2373f25dfb016938a">mdbx_txn_begin()</a>. Transactions may be read-write or read-only, and read-write transactions may be nested. A transaction must only be used by one thread at a time. Transactions are always required, even for read-only access. The transaction provides a consistent view of the data.</p>
<p>Once a transaction has been created, a database (i.e. key-value space inside the environment) can be opened within it using <a class="el" href="group__c__dbi.html#ga9bef4a9fdf27655e9343bbbf8b6fc5a1">mdbx_dbi_open()</a>. If only one database will ever be used in the environment, a <code>NULL</code> can be passed as the database name. For named databases, the <a class="el" href="group__c__dbi.html#ggafe3bddb297b3ab0d828a487c5726f76aad0235ae3602938cc0ca1c453d8c9fe27">MDBX_CREATE</a> flag must be used to create the database if it doesn't already exist. Also, <a class="el" href="group__c__settings.html#ga39ab74bb9bbfaab1cc586642fec4559a">mdbx_env_set_maxdbs()</a> must be called after <a class="el" href="group__c__opening.html#ga109eb833997698fbb77912716596fe8e">mdbx_env_create()</a> and before <a class="el" href="group__c__opening.html#gabb7dd3b10dd31639ba252df545e11768">mdbx_env_open()</a> to set the maximum number of named databases you want to support.</p>
<dl class="section note"><dt>Note</dt><dd>A single transaction can open multiple databases. Generally databases should only be opened once, by the first transaction in the process.</dd></dl>
<p>Within a transaction, <a class="el" href="group__c__crud.html#ga64b0d190e0740025a1858de4086e5860">mdbx_get()</a> and <a class="el" href="group__c__crud.html#gad0e171200fd96e98de0a2d4e120fa791">mdbx_put()</a> can store single key-value pairs if that is all you need to do (but see <a class="el" href="usage.html#Cursors">Cursors</a> below if you want to do more).</p>
<p>A key-value pair is expressed as two <a class="el" href="group__c__api.html#MDBX_val">MDBX_val</a> structures. This struct that is exactly similar to POSIX's <code>struct iovec</code> and has two fields, <code>iov_len</code> and <code>iov_base</code>. The data is a <code>void</code> pointer to an array of <code>iov_len</code> bytes. </p><dl class="section note"><dt>Note</dt><dd>The notable difference between MDBX and LMDB is that MDBX support zero length keys.</dd></dl>
<p>Because MDBX is very efficient (and usually zero-copy), the data returned in an <a class="el" href="group__c__api.html#MDBX_val">MDBX_val</a> structure may be memory-mapped straight from disk. In other words look but do not touch (or <code>free()</code> for that matter). Once a transaction is closed, the values can no longer be used, so make a copy if you need to keep them after that.</p>
<h2><a class="anchor" id="Cursors"></a>
Cursors</h2>
<p>To do more powerful things, we must use a cursor.</p>
<p>Within the transaction, a cursor can be created with <a class="el" href="group__c__cursors.html#ga0d4848769d9997eb0b6bbb9c6798237a">mdbx_cursor_open()</a>. With this cursor we can store/retrieve/delete (multiple) values using <a class="el" href="group__c__crud.html#gaea98ab004e84cd38f91ae94a6866eeaf">mdbx_cursor_get()</a>, <a class="el" href="group__c__crud.html#gacd7da9871acab9043665298f3c4996a3">mdbx_cursor_put()</a> and <a class="el" href="group__c__crud.html#ga124fee3155425c8d20ca86bfd2d10831">mdbx_cursor_del()</a>.</p>
<p>The <a class="el" href="group__c__crud.html#gaea98ab004e84cd38f91ae94a6866eeaf">mdbx_cursor_get()</a> positions itself depending on the cursor operation requested, and for some operations, on the supplied key. For example, to list all key-value pairs in a database, use operation <a class="el" href="group__c__cursors.html#gga501baff3bcff7e8e7818b4d412a2a6d5af60eae7d293d8ab7dce03a4545f5574a">MDBX_FIRST</a> for the first call to <a class="el" href="group__c__crud.html#gaea98ab004e84cd38f91ae94a6866eeaf">mdbx_cursor_get()</a>, and <a class="el" href="group__c__cursors.html#gga501baff3bcff7e8e7818b4d412a2a6d5ab8bdf3335426613971d0c90f5210cc7a">MDBX_NEXT</a> on subsequent calls, until the end is hit.</p>
<p>To retrieve all keys starting from a specified key value, use <a class="el" href="group__c__cursors.html#gga501baff3bcff7e8e7818b4d412a2a6d5ab4cc15ed389af37468723b1c3d10c8f1">MDBX_SET</a>. For more cursor operations, see the <a class="el" href="group__c__api.html">C API</a> reference.</p>
<p>When using <a class="el" href="group__c__crud.html#gacd7da9871acab9043665298f3c4996a3">\ref</a> , either the function will position the cursor for you based on the key, or you can use operation <a class="el" href="group__c__crud.html#gga5b8137591c45143c6d9439799be77136a64de8eefaa3b1680ad366f64655a2bb8">MDBX_CURRENT</a> to use the current position of the cursor. </p><dl class="section note"><dt>Note</dt><dd>Note that key must then match the current position's key.</dd></dl>
<h2><a class="anchor" id="autotoc_md46"></a>
Summarizing the opening</h2>
<p>So we have a cursor in a transaction which opened a database in an environment which is opened from a filesystem after it was separately created.</p>
<p>Or, we create an environment, open it from a filesystem, create a transaction within it, open a database within that transaction, and create a cursor within all of the above.</p>
<p>Got it?</p>
<h2><a class="anchor" id="autotoc_md47"></a>
Threads and processes</h2>
<p>Do not have open an database twice in the same process at the same time, MDBX will track and prevent this. Instead, share the MDBX environment that has opened the file across all threads. The reason for this is:</p><ul>
<li>When the "Open file description" locks (aka OFD-locks) are not available, MDBX uses POSIX locks on files, and these locks have issues if one process opens a file multiple times.</li>
<li>If a single process opens the same environment multiple times, closing it once will remove all the locks held on it, and the other instances will be vulnerable to corruption from other processes.</li>
<li>For compatibility with LMDB which allows multi-opening, MDBX can be configured at runtime by <a class="el" href="group__c__debug.html#gae5f003fad215cdd8253ef43b55a02ae0">mdbx_setup_debug()</a> with <a class="el" href="group__c__debug.html#gga90414ba5e7481fd2c34f629ffc32f7d4a5e8d81ab9cc65a4c79e4d5a9c8ecdf27">MDBX_DBG_LEGACY_MULTIOPEN</a>` option prior to calling other MDBX functions. In this way MDBX will track databases opening, detect multi-opening cases and then recover POSIX file locks as necessary. However, lock recovery can cause unexpected pauses, such as when another process opened the database in exclusive mode before the lock was restored - we have to wait until such a process releases the database, and so on.</li>
</ul>
<p>Do not use opened MDBX environment(s) after <code>fork()</code> in a child process(es), MDBX will check and prevent this at critical points. Instead, ensure there is no open MDBX-instance(s) during fork(), or at least close it immediately after <code>fork()</code> in the child process and reopen if required - for instance by using <code>pthread_atfork()</code>. The reason for this is:</p><ul>
<li>For competitive consistent reading, MDBX assigns a slot in the shared table for each process that interacts with the database. This slot is populated with process attributes, including the PID.</li>
<li>After <code>fork()</code>, in order to remain connected to a database, the child process must have its own such "slot", which can't be assigned in any simple and robust way another than the regular.</li>
<li>A write transaction from a parent process cannot continue in a child process for obvious reasons.</li>
<li>Moreover, in a multithreaded process at the fork() moment any number of threads could run in critical and/or intermediate sections of MDBX code with interaction and/or racing conditions with threads from other process(es). For instance: shrinking a database or copying it to a pipe, opening or closing environment, beginning or finishing a transaction, and so on. = Therefore, any solution other than simply close database (and reopen if necessary) in a child process would be both extreme complicated and so fragile.</li>
</ul>
<p>Do not start more than one transaction for a one thread. If you think about this, it's really strange to do something with two data snapshots at once, which may be different. MDBX checks and preventing this by returning corresponding error code (<a class="el" href="group__c__err.html#ggab5ba1469eef28a2e09ed243b608b11cea451522504ab193716f8f3b4396b2b614">MDBX_TXN_OVERLAPPING</a>, <a class="el" href="group__c__err.html#ggab5ba1469eef28a2e09ed243b608b11ceab12b07210795dae90a638c527df62dcc">MDBX_BAD_RSLOT</a>, <a class="el" href="group__c__err.html#ggab5ba1469eef28a2e09ed243b608b11cea971ec6ff2bc8db798c920a3bde3bab5d">MDBX_BUSY</a>) unless you using <a class="el" href="group__c__opening.html#gga9138119a904355d245777c4119534061a79e1de212a2f3a1018c2da2c4b511cb8">MDBX_NOTLS</a> option on the environment. Nonetheless, with the <a class="el" href="group__c__opening.html#gga9138119a904355d245777c4119534061a79e1de212a2f3a1018c2da2c4b511cb8">MDBX_NOTLS</a> option, you must know exactly what you are doing, otherwise you will get deadlocks or reading an alien data.</p>
<p>Also note that a transaction is tied to one thread by default using Thread Local Storage. If you want to pass read-only transactions across threads, you can use the <a class="el" href="group__c__opening.html#gga9138119a904355d245777c4119534061a79e1de212a2f3a1018c2da2c4b511cb8">MDBX_NOTLS</a> option on the environment. Nevertheless, a write transaction entirely should only be used in one thread from start to finish. MDBX checks this in a reasonable manner and return the <a class="el" href="group__c__err.html#ggab5ba1469eef28a2e09ed243b608b11cea7f9a4b39c6651951ab40a33641eb8279">MDBX_THREAD_MISMATCH</a> error in rules violation.</p>
<h2><a class="anchor" id="autotoc_md48"></a>
Transactions, rollbacks etc</h2>
<p>To actually get anything done, a transaction must be committed using <a class="el" href="group__c__transactions.html#ga3146a36cf1d0603cc6e3d52e97ec38a9">mdbx_txn_commit()</a>. Alternatively, all of a transaction's operations can be discarded using <a class="el" href="group__c__transactions.html#ga9773fd77d15cc810fc4eff0060f1a596">mdbx_txn_abort()</a>.</p>
<dl class="section attention"><dt>Attention</dt><dd>An important difference between MDBX and LMDB is that MDBX required that any opened cursors can be reused and must be freed explicitly, regardless ones was opened in a read-only or write transaction. The REASON for this is eliminates ambiguity which helps to avoid errors such as: use-after-free, double-free, i.e. memory corruption and segfaults.</dd></dl>
<p>For read-only transactions, obviously there is nothing to commit to storage. </p><dl class="section attention"><dt>Attention</dt><dd>An another notable difference between MDBX and LMDB is that MDBX make handles opened for existing databases immediately available for other transactions, regardless this transaction will be aborted or reset. The REASON for this is to avoiding the requirement for multiple opening a same handles in concurrent read transactions, and tracking of such open but hidden handles until the completion of read transactions which opened them.</dd></dl>
<p>In addition, as long as a transaction is open, a consistent view of the database is kept alive, which requires storage. A read-only transaction that no longer requires this consistent view should be terminated (committed or aborted) when the view is no longer needed (but see below for an optimization).</p>
<p>There can be multiple simultaneously active read-only transactions but only one that can write. Once a single read-write transaction is opened, all further attempts to begin one will block until the first one is committed or aborted. This has no effect on read-only transactions, however, and they may continue to be opened at any time.</p>
<h2><a class="anchor" id="autotoc_md49"></a>
Duplicate keys aka Multi-values</h2>
<p><a class="el" href="group__c__crud.html#ga64b0d190e0740025a1858de4086e5860">mdbx_get()</a> and <a class="el" href="group__c__crud.html#gad0e171200fd96e98de0a2d4e120fa791">mdbx_put()</a> respectively have no and only some support or multiple key-value pairs with identical keys. If there are multiple values for a key, <a class="el" href="group__c__crud.html#ga64b0d190e0740025a1858de4086e5860">mdbx_get()</a> will only return the first value.</p>
<p>When multiple values for one key are required, pass the <a class="el" href="group__c__dbi.html#ggafe3bddb297b3ab0d828a487c5726f76aaed33d978b4e23b7c1659e8106e9c7acd">MDBX_DUPSORT</a> flag to <a class="el" href="group__c__dbi.html#ga9bef4a9fdf27655e9343bbbf8b6fc5a1">mdbx_dbi_open()</a>. In an <a class="el" href="group__c__dbi.html#ggafe3bddb297b3ab0d828a487c5726f76aaed33d978b4e23b7c1659e8106e9c7acd">MDBX_DUPSORT</a> database, by default <a class="el" href="group__c__crud.html#gad0e171200fd96e98de0a2d4e120fa791">mdbx_put()</a> will not replace the value for a key if the key existed already. Instead it will add the new value to the key. In addition, <a class="el" href="group__c__crud.html#gaaab819c1e740210d211ebabad424795b">mdbx_del()</a> will pay attention to the value field too, allowing for specific values of a key to be deleted.</p>
<p>Finally, additional cursor operations become available for traversing through and retrieving duplicate values.</p>
<h2><a class="anchor" id="autotoc_md50"></a>
Some optimization</h2>
<p>If you frequently begin and abort read-only transactions, as an optimization, it is possible to only reset and renew a transaction.</p>
<p><a class="el" href="group__c__transactions.html#gae9f34737fe60b0ba538d5a09b6a25c8d">mdbx_txn_reset()</a> releases any old copies of data kept around for a read-only transaction. To reuse this reset transaction, call <a class="el" href="group__c__transactions.html#gaf3cd3707d0154f81f7f73484068246d1">mdbx_txn_renew()</a> on it. Any cursors in this transaction can also be renewed using <a class="el" href="group__c__cursors.html#gac3de6997b14c5ef0f0bc7f7e87fab32a">mdbx_cursor_renew()</a> or freed by <a class="el" href="group__c__cursors.html#gacc2a457fd66edc35ab44f15cd0563341">mdbx_cursor_close()</a>.</p>
<p>To permanently free a transaction, reset or not, use <a class="el" href="group__c__transactions.html#ga9773fd77d15cc810fc4eff0060f1a596">mdbx_txn_abort()</a>.</p>
<h2><a class="anchor" id="autotoc_md51"></a>
Cleaning up</h2>
<p>Any created cursors must be closed using <a class="el" href="group__c__cursors.html#gacc2a457fd66edc35ab44f15cd0563341">mdbx_cursor_close()</a>. It is advisable to repeat: </p><dl class="section note"><dt>Note</dt><dd>An important difference between MDBX and LMDB is that MDBX required that any opened cursors can be reused and must be freed explicitly, regardless ones was opened in a read-only or write transaction. The REASON for this is eliminates ambiguity which helps to avoid errors such as: use-after-free, double-free, i.e. memory corruption and segfaults.</dd></dl>
<p>It is very rarely necessary to close a database handle, and in general they should just be left open. When you close a handle, it immediately becomes unavailable for all transactions in the environment. Therefore, you should avoid closing the handle while at least one transaction is using it.</p>
<h2><a class="anchor" id="autotoc_md52"></a>
Now read up on the full API!</h2>
<p>The full <a class="el" href="group__c__api.html">C API</a> documentation lists further details below, like how to:</p>
<ul>
<li>Configure database size and automatic size management: <a class="el" href="group__c__settings.html#ga79065e4f3c5fb2ad37a52b59224d583e">mdbx_env_set_geometry()</a>.</li>
<li>Drop and clean a database: <a class="el" href="group__c__crud.html#gadc9d57659242902003bb5459bc063b32">mdbx_drop()</a>.</li>
<li>Detect and report errors: <a class="el" href="group__c__err.html">Error handling</a>.</li>
<li>Optimize (bulk) loading speed: <a class="el" href="group__c__crud.html#gga5b8137591c45143c6d9439799be77136a2c3d75f9a4f36afd99a5c0718ef024de">MDBX_MULTIPLE</a>, <a class="el" href="group__c__crud.html#gga5b8137591c45143c6d9439799be77136a99e8cb1fb3cbaeb7aeed5b542abc4ded">MDBX_APPEND</a>.</li>
<li>Reduce (temporarily) robustness to gain even more speed: <a class="el" href="group__sync__modes.html">SYNC MODES</a>.</li>
<li>Gather statistics about the database: <a class="el" href="group__c__statinfo.html">Statistics &amp; Information</a>.</li>
<li>Sstimate size of range query result: <a class="el" href="group__c__rqest.html">Range query estimation</a>.</li>
<li>Double performance by LIFO reclaiming on storages with write-back: <a class="el" href="group__c__opening.html#gga9138119a904355d245777c4119534061a37585486d4e99bcb599cc15b408137b0">MDBX_LIFORECLAIM</a>.</li>
<li>Use sequences and canary markers: <a class="el" href="group__c__crud.html#ga27bedd3c425e93440ad82290a5cf2f03">mdbx_dbi_sequence()</a>, <a class="el" href="struct_m_d_b_x__canary.html">MDBX_canary</a>.</li>
<li>Use Handle-Slow-Readers callback to resolve a database full/overflow issues due to long-lived read transactions: <a class="el" href="group__c__err.html#ga2568f844c324a481945fb2a3355bf8ea">mdbx_env_set_hsr()</a>.</li>
<li>Use exclusive mode: <a class="el" href="group__c__opening.html#gga9138119a904355d245777c4119534061aa516c74e6fed22c9812bb909c8c459ed">MDBX_EXCLUSIVE</a>.</li>
<li>Define custom sort orders (but this is recommended to be avoided).</li>
</ul>
<h1><a class="anchor" id="bindings"></a>
Bindings</h1>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Runtime </th><th class="markdownTableHeadNone">Repo </th><th class="markdownTableHeadNone">Author  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Scala </td><td class="markdownTableBodyNone"><a href="https://github.com/david-bouyssie/mdbx4s">mdbx4s</a> </td><td class="markdownTableBodyNone"><a href="https://github.com/david-bouyssie">David BouyssiÃ©</a>  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Haskell </td><td class="markdownTableBodyNone"><a href="https://hackage.haskell.org/package/libmdbx">libmdbx-hs</a> </td><td class="markdownTableBodyNone"><a href="https://github.com/fjvallarino">Francisco Vallarino</a>  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">NodeJS, <a href="https://deno.land/">Deno</a> </td><td class="markdownTableBodyNone"><a href="https://github.com/kriszyp/lmdbx-js">lmdbx-js</a> </td><td class="markdownTableBodyNone"><a href="https://github.com/kriszyp/">Kris Zyp</a>  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">NodeJS </td><td class="markdownTableBodyNone"><a href="https://www.npmjs.com/package/node-mdbx/">node-mdbx</a> </td><td class="markdownTableBodyNone"><a href="#" onclick="location.href='mai'+'lto:'+'ser'+'ge'+'y.f'+'ed'+'oto'+'v@'+'cor'+'p.'+'mai'+'l.'+'ru'; return false;">Ð¡ÐµÑ€Ð³ÐµÐ¹ Ð¤ÐµÐ´Ð¾Ñ‚Ð¾Ð²</a>  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Ruby </td><td class="markdownTableBodyNone"><a href="https://rubygems.org/gems/mdbx/">ruby-mdbx</a> </td><td class="markdownTableBodyNone"><a href="https://github.com/mahlonsmith">Mahlon E. Smith</a>  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Go </td><td class="markdownTableBodyNone"><a href="https://github.com/torquem-ch/mdbx-go">mdbx-go</a> </td><td class="markdownTableBodyNone"><a href="https://github.com/AskAlexSharov">Alex Sharov</a>  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><a href="https://en.wikipedia.org/wiki/Nim_(programming_language)">Nim</a> </td><td class="markdownTableBodyNone"><a href="https://github.com/snej/nimdbx">NimDBX</a> </td><td class="markdownTableBodyNone"><a href="https://github.com/snej">Jens Alfke</a>  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Rust </td><td class="markdownTableBodyNone"><a href="https://github.com/vorot93/libmdbx-rs">libmdbx-rs</a> </td><td class="markdownTableBodyNone"><a href="https://github.com/vorot93">Artem Vorotnikov</a>  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Rust </td><td class="markdownTableBodyNone"><a href="https://crates.io/crates/mdbx">mdbx</a> </td><td class="markdownTableBodyNone"><a href="https://github.com/gcxfd">gcxfd</a>  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Java </td><td class="markdownTableBodyNone"><a href="https://github.com/castortech/mdbxjni">mdbxjni</a> </td><td class="markdownTableBodyNone"><a href="https://castortech.com/">Castor Technologies</a>  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Python (draft) </td><td class="markdownTableBodyNone"><a href="https://github.com/erthink/libmdbx/commits/python-bindings">python-bindings</a> branch </td><td class="markdownTableBodyNone"><a href="https://github.com/Thermi">Noel Kuntze</a>  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">.NET (obsolete) </td><td class="markdownTableBodyNone"><a href="https://github.com/wangjia184/mdbx.NET">mdbx.NET</a> </td><td class="markdownTableBodyNone"><a href="https://github.com/wangjia184">Jerry Wang</a>  </td></tr>
</table>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.17 </li>
  </ul>
</div>
</body>
</html>
